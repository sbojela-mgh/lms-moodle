define ("block_reportdashboard/reportdashboard",["core/ajax","block_learnerscript/report","block_learnerscript/reportwidget","block_learnerscript/schedule","block_learnerscript/helper","block_learnerscript/ajax","block_learnerscript/select2","block_learnerscript/jquery.dataTables","block_learnerscript/radioslider","block_learnerscript/flatpickr","core/str","jquery","jqueryui","block_learnerscript/bootstrapnotify","block_reportdashboard/inplace_editable"],function(a,b,c,d,e,f,g,h,i,j,k,l){return{init:function init(){l(document).ajaxStop(function(){l(".loader").fadeOut("slow")});e.Select2Ajax({});l(".dashboardcourses").change(function(){var a=l(this).val();l(".report_courses").val(a);c.DashboardTiles();c.DashboardWidgets();l(".viewmore").each(function(){l(this).attr("href")})});l("#createdashbaord_form").submit(function(a){var b=l("#id_dashboard").val(),c=b.trim();if(""==c||null==c){l("#id_error_dashboard").css("display","block");l("#id_error_dashboard_nospaces").css("display","none");a.preventDefault()}spaceexist=c.indexOf(" ");if(0<spaceexist&&""!=spaceexist){l("#id_error_dashboard").css("display","none");l("#id_error_dashboard_nospaces").css("display","block");a.preventDefault()}});l.ui.dialog.prototype._focusTabbable=l.noop;var a=l("#dashboard-header").position();l(".sidenav").offset({top:0});l("#internalbsm").offset({top:a.top});l("select[data-select2='1']").select2();e.Select2Ajax({action:"reportlist",multiple:!0});l(document).on("click",".filterform #id_filter_clear",function(){l(this).parents(".mform").trigger("reset");var a=l(this).parents(".mform").find("#id_filter_activities"),b=l(this).parents(".block_reportdashboard").find(".report_dashboard_container"),d=b.data("reportid"),e=b.data("reporttype"),f=b.data("blockinstance"),g=l(this).parents(".mform").find("#id_filter_users");smartfilter.CourseActivities({courseid:0,element:a});l(".filterform select[data-select2-ajax='1']").val("0").trigger("change");l(".filterform")[0].reset();l(".filterform #id_filter_clear").attr("disabled","disabled");c.CreateDashboardwidget({reportid:d,reporttype:e,instanceid:f})});l(document).on("change","select[name='filter_coursecategories']",function(){var a=this.value,b=l(this).closest(".mform").find("#id_filter_courses");if(0!=b.length){smartfilter.categoryCourses({categoryid:a,element:b})}});l(document).on("change","select[name='filter_courses']",function(){var a=this.value,b=l(this).closest(".mform").find("#id_filter_activities"),c=l(this).closest(".mform").find("#id_filter_users");if(0!=b.length){smartfilter.CourseActivities({courseid:a,element:b})}});i.init(l("#segmented-button"),{size:"medium",animation:!0,reportdashboard:!0});j("#customrange",{mode:"range",onOpen:function onOpen(a,b,c){c.clear()},onClose:function onClose(a){l("#ls_fstartdate").val(a[0].getTime()/1e3);l("#ls_fenddate").val(a[1].getTime()/1e3+86400);require(["block_learnerscript/reportwidget"],function(){c.DashboardTiles();c.DashboardWidgets()})}});window.onclick=function(a){if(!a.target.matches(".dropbtn")){var b=document.getElementsByClassName("dropdown-content"),c;for(c=0;c<b.length;c++){var d=b[c];if(l(d).hasClass("show")){l(d).toggleClass("show")}}}}},addblocks_to_dashboard:function addblocks_to_dashboard(){k.get_string("addblockstodashboard","block_reportdashboard").then(function(){if(0<l(".reportslist").html().length){console.log("here");l(".reportslist").dialog()}else{l.urlParam=function(a){var b=new RegExp("[?&]"+a+"=([^&#]*)").exec(window.location.href);if(null===b||" "==b){return null}else{return b[1]||0}};var b=l.urlParam("role"),c=l.urlParam("dashboardurl"),d=l.urlParam("contextlevel"),e=a.call([{methodname:"block_reportdashboard_addwidget_to_dashboard",args:{role:b,dashboardurl:c,contextlevel:d}}]);e[0].done(function(a){var b="<img class='dialog_title_icon' alt='Add Widgets' src='"+M.util.image_url("add_widgets_icon","block_reportdashboard")+"'/>";l(".reportslist").dialog({title:"Add widgets to dashboard",modal:!0,minWidth:700,maxHeight:600});l(".reportslist").closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");l(".reportslist").closest(".ui-dialog").find(".ui-dialog-title").html(b+"Add widgets to dashboard");resp=JSON.parse(a);console.log(resp);l(".reportslist").html(resp)}).fail(function(){console.log("Add Tiles")})}})},addtiles_to_dashboard:function addtiles_to_dashboard(){k.get_string("addtilestodashboard","block_reportdashboard").then(function(){if(0<l(".statistics_reportslist").html().length){l(".statistics_reportslist").dialog()}else{l.urlParam=function(a){var b=new RegExp("[?&]"+a+"=([^&#]*)").exec(window.location.href);if(null===b||" "==b){return null}else{return b[1]||0}};var b=l.urlParam("role"),c=l.urlParam("dashboardurl"),d=l.urlParam("contextlevel"),e=a.call([{methodname:"block_reportdashboard_addtiles_to_dashboard",args:{role:b,dashboardurl:c,contextlevel:d}}]);e[0].done(function(a){var b="<img class='dialog_title_icon' alt='Add Tiles' src='"+M.util.image_url("add_tiles_icon","block_reportdashboard")+"'/>";l(".statistics_reportslist").dialog({title:"Add tiles to dashboard",modal:!0,minWidth:600,maxHeight:600});l(".statistics_reportslist").closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");l(".statistics_reportslist").closest(".ui-dialog").find(".ui-dialog-title").html(b+"Add tiles to dashboard");resp=JSON.parse(a);l(".statistics_reportslist").html(resp)}).fail(function(){console.log("Add Tiles")})}})},addnewdashboard:function addnewdashboard(){k.get_string("addnewdashboard","block_reportdashboard").then(function(a){document.getElementById("id_dashboard").value="";l("#id_error_dashboard").css("display","none");var b="<img class='dialog_title_icon' alt='Add new dashboard' src='"+M.util.image_url("add_tiles_icon","block_reportdashboard")+"'/>";l(".newreport_dashboard").dialog({title:a,modal:!0,minWidth:450,maxHeight:600});l(".newreport_dashboard").closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");var c=l(".ui-icon-closethick").parent();l(c).attr({title:"Close"});l(".newreport_dashboard").closest(".ui-dialog").find(".ui-dialog-title").html(b+a)})},updatedashboard:function updatedashboard(a,b){k.get_string("updatedashboard","block_reportdashboard").then(function(c){l("#id_error_dashboard").css("display","none");l("#id_error_dashboard_nospaces").css("display","none");var d="<img class='dialog_title_icon' alt='Add new dashboard' src='"+M.util.image_url("add_tiles_icon","block_reportdashboard")+"'/>";l(".newreport_dashboard").dialog({title:c,modal:!0,minWidth:450,maxHeight:600});l(".newreport_dashboard").closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");var e=l(".ui-icon-closethick").parent();l(e).attr({title:"Close"});l(".newreport_dashboard").closest(".ui-dialog").find(".ui-dialog-title").html(d+c);document.getElementById("id_dashboard").value=a;l("#createdashbaord_form").submit(function(c){var d=l("#id_dashboard").val(),e=d.trim();if(""==e||null==e){l("#id_error_dashboard").css("display","block");l("#id_error_dashboard_nospaces").css("display","none");c.preventDefault();return!1}spaceexist=e.indexOf(" ");if(0<spaceexist&&""!=spaceexist){l("#id_error_dashboard").css("display","none");l("#id_error_dashboard_nospaces").css("display","block");c.preventDefault();return!1}var g={action:"updatedashboard",role:b,oldname:a,newname:document.getElementById("id_dashboard").value};senddata=JSON.stringify(g);f.call({args:g,url:M.cfg.wwwroot+"/blocks/reportdashboard/ajax.php"})})})},sendreportemail:function sendreportemail(a){k.get_strings([{key:"sendemail",component:"block_reportdashboard"}]).then(function(b){var c=M.cfg.wwwroot+"/blocks/learnerscript/ajax.php";a.nodeContent="sendreportemail"+a.instanceid;a.action="sendreportemail";a.title=b;AjaxForms=require("block_learnerscript/ajaxforms");AjaxForms.init(a,c)})},reportfilter:function reportfilter(b){var c=this;if(1>l(".report_filter_"+b.instanceid).length){var d=a.call([{methodname:"block_learnerscript_reportfilter",args:{action:"reportfilter",reportid:b.reportid,instance:b.instanceid}}]);d[0].done(function(a){l("body").append("<div class='report_filter_"+b.instanceid+"' style='display:none;'>"+a+"</div>");l("select[data-select2-ajax='1']").each(function(){if(!l(this).hasClass("select2-hidden-accessible")){e.Select2Ajax({})}});c.reportFilterFormModal(b);l(".filterform"+b.instanceid+" .fitemtitle").hide();l(".filterform"+b.instanceid+" .felement").attr("style","margin:0")})}else{c.reportFilterFormModal(b)}},reportFilterFormModal:function reportFilterFormModal(a){k.get_string("reportfilters","block_reportdashboard").then(function(b){var c="<img class='dialog_title_icon' alt='Filter' src='"+M.util.image_url("reportfilter","block_reportdashboard")+"'/>";l(".report_filter_"+a.instanceid).dialog({title:b,dialogClass:"reportfilter-popup",modal:!0,resizable:!0,autoOpen:!0,draggable:!1,width:420,height:"auto",appendTo:"#inst"+a.instanceid,position:{my:"center",at:"center",of:"#inst"+a.instanceid,within:"#inst"+a.instanceid},open:function open(){l(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");var d=l(".ui-icon-closethick").parent();l(d).attr({title:"Close"});l(this).closest(".ui-dialog").find(".ui-dialog-title").html(c+b);l(".report_filter_"+a.instanceid+" form  #id_filter_apply").click(function(b){b.preventDefault();b.stopImmediatePropagation();if(0<l("#reportcontainer"+a.instanceid).html().length){a.reporttype=l("#reportcontainer"+a.instanceid).data("reporttype")}else{a.reporttype=l("#plotreportcontainer"+a.instanceid).data("reporttype")}l(".filterform"+a.instanceid).serializeArray();a.container="#reporttype_"+a.reportid;require(["block_learnerscript/reportwidget"],function(b){b.CreateDashboardwidget({reportid:a.reportid,reporttype:a.reporttype,instanceid:a.instanceid});l(".report_filter_"+a.instanceid).dialog("close")});l(".report_filter_"+a.instanceid+" form #id_filter_clear").removeAttr("disabled")})}});l(".report_filter_"+a.instanceid+" form #id_filter_clear").click(function(b){b.preventDefault();l(".filterform"+a.reportid).trigger("reset");require(["block_learnerscript/reportwidget"],function(b){b.DashboardWidgets(a);l(".report_filter_"+a.instanceid).dialog("close")});l(".report_filter_"+a.instanceid).dialog("close")})})},DeleteWidget:function DeleteWidget(a){k.get_string("deletewidget","block_reportdashboard").then(function(b){l("#delete_dialog"+a.instanceid).dialog({resizable:!0,autoOpen:!0,width:460,height:210,title:b,modal:!0,appendTo:"#inst"+a.instanceid,position:{my:"center",at:"center",of:"#inst"+a.instanceid,within:"#inst"+a.instanceid},open:function open(){l(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");var a=l(".ui-icon-closethick").parent();l(a).attr({title:"Close"})}})})},Deletedashboard:function Deletedashboard(a){k.get_string("deletedashboard","block_reportdashboard").then(function(b){a.instance;l("#dashboard_delete_popup_"+a.random).dialog({resizable:!1,height:150,width:375,modal:!0,title:b,open:function open(){l(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");var a=l(".ui-icon-closethick").parent();l(a).attr({title:"Close"})},close:function close(){l(this).dialog("destroy").hide()}})})},schreportform:function schreportform(a){this;k.get_string("schedulereport","block_reportdashboard").then(function(b){var c=M.cfg.wwwroot+"/blocks/learnerscript/ajax.php";a.title=b;a.nodeContent="schreportform"+a.instanceid;a.action="schreportform";a.courseid=l("[name=\"filter_courses\"]").val();AjaxForms=require("block_learnerscript/ajaxforms");AjaxForms.init(a,c)})}}});
//# sourceMappingURL=reportdashboard.min.js.map

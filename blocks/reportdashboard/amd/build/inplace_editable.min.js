define ("block_reportdashboard/inplace_editable",["jquery","core/ajax","core/templates","core/notification","core/str","core/config","core/url"],function(a,b,c,d,e,f,g){a("body").on("click keypress","[data-inplaceeditable] [data-inplaceeditablelink]",function(c){if("keypress"===c.type&&13!==c.keyCode){return}c.stopImmediatePropagation();c.preventDefault();var h=a(this),j=h.closest("[data-inplaceeditable]"),k=function(b){b.addClass("updating");var c=b.find("img.spinner");if(c.length){c.show()}else{c=a("<img/>").attr("src",g.imageUrl("i/loading_small")).addClass("spinner").addClass("smallicon");b.append(c)}},l=function(a){a.removeClass("updating");a.find("img.spinner").hide()},m=function(c,f){k(c);b.call([{methodname:"block_reportdashboard_inplace_editable_dashboard",args:{prevoiusdashboardname:c.attr("data-prevoiusdashboardname"),pagetypepattern:c.attr("data-pagetypepattern"),subpagepattern:c.attr("data-subpagepattern"),value:f},done:function done(a){var b=c.attr("data-roleshortname");if(""==b){window.location.href=M.cfg.wwwroot+"/blocks/reportdashboard/dashboard.php?dashboardurl="+a}else{window.location.href=M.cfg.wwwroot+"/blocks/reportdashboard/dashboard.php?dashboardurl="+a+"&role="+b}},fail:function fail(b){var g=a.Event("updatefailed",{exception:b,newvalue:f});l(c);c.trigger(g);if(!g.isDefaultPrevented()){d.exception(b)}}}],!0)},n=function(a){a.find("input").off();a.find("select").off();a.html(a.attr("data-oldcontent"));a.removeAttr("data-oldcontent");a.removeClass("inplaceeditingon");a.find("[data-inplaceeditablelink]").focus()},o=function(b,c){var d=b,e;for(e=0;e<c;e++){d+=Math.floor(10*Math.random())+""}if(0===a("#"+d).length){return d}return o(b,c)},p=function(b){e.get_string("edittitleinstructions").done(function(c){var d=a("<span class=\"editinstructions\">"+c+"</span>").attr("id",o("id_editinstructions_",20)),e=a("<input type=\"text\"/>").attr("id",o("id_inplacevalue_",20)).attr("value",b.attr("data-value")).attr("aria-describedby",d.attr("id")).addClass("ignoredirty").addClass("form-control"),g=a("<label class=\"accesshide\">"+j.attr("data-editlabel")+"</label>").attr("for",e.attr("id"));b.html("").append(d).append(g).append(e);e.focus();e.select();e.on("keyup keypress focusout",function(a){if(f.behatsiterunning&&"focusout"===a.type){return}if("keypress"===a.type&&13===a.keyCode){var c=e.val();n(b);m(b,c)}if("keyup"===a.type&&27===a.keyCode||"focusout"===a.type){n(b)}})})},q=function(a,b){n(a);m(a,b)},r=function(b,c){var d,e=a("<select></select>").attr("id",o("id_inplacevalue_",20)).addClass("custom-select"),g=a("<label class=\"accesshide\">"+j.attr("data-editlabel")+"</label>").attr("for",e.attr("id"));for(d in c){e.append(a("<option>").attr("value",c[d].key).html(c[d].value))}e.val(b.attr("data-value"));b.html("").append(g).append(e);e.focus();e.select();e.on("keyup change focusout",function(a){if(f.behatsiterunning&&"focusout"===a.type){return}if("change"===a.type){var c=e.val();n(b);m(b,c)}if("keyup"===a.type&&27===a.keyCode||"focusout"===a.type){n(b)}})};(function turnEditingOffEverywhere(){a("span.inplaceeditable.inplaceeditingon").each(function(){n(a(this))})})();(function turnEditingOn(b){b.addClass("inplaceeditingon");b.attr("data-oldcontent",b.html());var c=b.attr("data-type"),d=b.attr("data-options");if("toggle"===c){q(b,d)}else if("select"===c){r(b,a.parseJSON(d))}else{p(b)}})(j)});return{}});
//# sourceMappingURL=inplace_editable.min.js.map

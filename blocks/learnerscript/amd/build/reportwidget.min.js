define ("block_learnerscript/reportwidget",["jquery","core/ajax","block_learnerscript/report","block_learnerscript/smartfilter"],function(a,b,c,d){return reportwidget={DashboardWidgets:function DashboardWidgets(b){var c=this,b=b||{container:".report_dashboard_container"},e=d.FilterData(b.reportid);a(".loader").show();a(b.container).each(function(){var d=a(this).data("reportid"),f=a(this).data("blockinstance");if(""!=a(this).val()){var f=a("#reportcontainer"+reportinstance).data("blockinstance");b.reporttype=a("#reporttype_"+f+"  :selected").val();var g={reportid:d,reporttype:b.reporttype};a.extend(g,e);c.CreateDashboardwidget(g);return!1}b.reporttype=a("#reporttype_"+f+"  :selected").val();if("undefined"==typeof b.reporttype){b.reporttype=a(this).data("reporttype")}c.CreateDashboardwidget({reportid:d,reporttype:b.reporttype,instanceid:f})})},DashboardTiles:function DashboardTiles(){var b=this;ls_fstartdate=a("#ls_fstartdate").val();ls_fenddate=a("#ls_fenddate").val();var c=a("#ls_courseid").val();a(".tiles_information").each(function(){b.CreateDashboardTile({blockinstanceid:a(this).data("instanceid"),reportid:a(this).data("reportid"),reporttype:a(this).data("reporttype"),ls_fstartdate:ls_fstartdate,ls_fenddate:ls_fenddate,courseid:c})})},CreateDashboardTile:function CreateDashboardTile(c){this;a("#inst"+c.blockinstanceid+" .tiles_information table tr").html("");var d=c.blockinstanceid,e={};e.ls_fstartdate=a("#ls_fstartdate").val();e.ls_fenddate=a("#ls_fenddate").val();a.urlParam=function(a){var b=new RegExp("[?&]"+a+"=([^&#]*)").exec(window.location.href);if(null===b||" "==b){return null}else{return b[1]||0}};var f=a.urlParam("dashboardurl");if("undefined"==typeof e.filter_courses){var g=a(".report_courses").val();if("Course"==f){c.courseid=g}if(1!=g){e.filter_courses=g}}var h=b.call([{methodname:"block_learnerscript_generate_plotgraph",args:{instanceid:c.blockinstanceid,reportid:c.reportid,courseid:c.courseid,filters:JSON.stringify(e),reporttype:c.reporttype},loading:"#reportloading_"+c.blockinstanceid}]);h[0].done(function(b){b=JSON.parse(b);var e=[];if("table"!=c.reporttype){a.extend(b.plot,c);b.plot.container="#plotreportcontainer"+d;if(!0===b.plot.error){a("#plotreportcontainer"+d).html("<p class=\"alert alert-warning\">"+b.plot.messages+"</p>")}else{if(0==b.plot.data.length){a(b.plot.container).html("<div class='alert alert-info'>Data Not Available.</div>")}else{b.plot.reportinstance=d;require(["block_learnerscript/report"],function(a){a.generate_plotgraph(b.plot)})}}}else{if("undefined"!=typeof b.plot){if(0<b.plot.data.length){a(b.plot.data).each(function(a,b){e=[];b.head;e=b.data});a(b.plot.categorydata).each(function(d,f){if(1==b.plot.categorydata.length){if(!isNaN(e[0][d])){a("#inst"+c.blockinstanceid+" .tiles_information table tr").append("<td><h1 "+c.styletilescolour+"> "+e[0][d]+" </h1></td>")}else{a("#inst"+c.blockinstanceid+" .tiles_information table tr").append("<td><h6 "+c.styletilescolour+"> "+e[0][d]+" </h6></td>")}}else{a("#inst"+c.blockinstanceid+" .tiles_information table tr").append("<td>"+f+" : <b> "+e[d]+" </b></td>")}})}else{a("#inst"+c.blockinstanceid+" .tiles_information table tr").html("<div class='alert alert-info'> No Data Available.</div>");a("#inst"+c.blockinstanceid+" .dashboard_tiles").css("color","#4B4B4B")}a("#reportloading_"+c.blockinstanceid).css("display","none")}}})},CreateDashboardwidget:function CreateDashboardwidget(c){var e=this,f=c.instanceid||c.reportid;c.filters=d.FilterData(f);c.columnDefs="";c.filters.ls_fstartdate=a("#ls_fstartdate").val();c.filters.ls_fenddate=a("#ls_fenddate").val();if("undefined"==typeof c.filters.filter_courses){var g=a(".report_courses").val();if(1!=g){c.filters.filter_courses=g}}if(!("table"==c.reporttype)){a(".plotgraphcontainer").removeClass("hide").addClass("show")}if(c.selectreport){a("#reportcontainer"+f).attr("data-reporttype",c.singleplot);a("#plotreportcontainer"+f).attr("data-reporttype",c.singleplot);delete c.selectreport}c.filters=JSON.stringify(c.filters);c.action="generate_plotgraph";a(".download_menu"+f+" li a").each(function(){var b=a(this).attr("href");if("undefined"!=typeof c.basicparams){var d=JSON.parse(c.basicparams);a.each(d,function(a,c){if(0==a.indexOf("filter_")){b+="&"+a+"="+c}})}if("undefined"!=typeof c.filters){var e=JSON.parse(c.filters);a.each(e,function(a,c){if(0==a.indexOf("filter_")){b+="&"+a+"="+c}if(0==a.indexOf("ls_")){b+="&"+a+"="+c}})}a(this).attr("href",b)});c.basicparams=c.basicparams||JSON.stringify(d.BasicparamsData(f));if("undefined"!=typeof c.reportdashboard&&"undefined"!=typeof c.reporttype){a("#reportcontainer"+f).html("");a("#plotreportcontainer"+f).html("")}else{if("undefined"!=typeof c.reportdashboard&&"table"==c.reporttype){a("#reportcontainer"+f).html("")}else{a("#plotreportcontainer"+f).html("")}}var h=b.call([{methodname:"block_learnerscript_generate_plotgraph",args:c,loading:"#reportloading_"+c.reportid}]);if(0>=a("#reportloadingimage").length){if("table"==c.reporttype){a("#reportcontainer"+c.reportid).prepend("<img src=\""+M.util.image_url("loading","block_learnerscript")+"\" id=\"reportloadingimage\" />")}else{a("#plotreportcontainer"+c.reportid).prepend("<img src=\""+M.util.image_url("loading","block_learnerscript")+"\" id=\"reportloadingimage\" />")}}h[0].done(function(b){b=a.parseJSON(b);var d=b.reporttype||c.reporttype;if("table"==d){if("undefined"==typeof b.data&&b.emptydata){if(!a("#reporttable_"+c.reportid).length){a("#reportcontainer"+f).html(b.tdata)}a(document).ajaxStop(function(){a("#reportloadingimage").remove()});c.reportname=b.reportname;require(["block_learnerscript/report"],function(a){a.ReportDatatable(c)})}else{if(!a("#reporttable_"+c.reportid).length){a("#reportcontainer"+f).html(b.tdata)}a(document).ajaxStop(function(){a("#reportloadingimage").remove()});c.columnDefs=b.columnDefs;c.data=b.data;c.reportname=b.reportname;require(["block_learnerscript/report"],function(a){a.ReportDatatable(c)})}}else{a.extend(b.plot,c);b.plot.container="#plotreportcontainer"+f;a(document).ajaxStop(function(){a("#reportloadingimage").remove()});if(!0===b.plot.error){a("#plotreportcontainer"+f).html("<p class=\"alert alert-warning\">"+b.plot.messages+"</p>")}else{if(b.plot.data&&0<b.plot.data.length){b.plot.reportinstance=f;require(["block_learnerscript/report"],function(a){a.generate_plotgraph(b.plot)})}else{a(b.plot.container).html("<p class=\"alert alert-warning\">No data available</p>")}}}}).fail(function(){})}}});
//# sourceMappingURL=reportwidget.min.js.map

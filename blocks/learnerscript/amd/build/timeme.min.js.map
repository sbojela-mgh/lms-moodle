{"version":3,"sources":["../src/timeme.js"],"names":["root","factory","module","exports","define","amd","TimeMe","startStopTimes","idleTimeoutMs","currentIdleTimeMs","checkStateRateMs","active","idle","currentPageName","timeElapsedCallbacks","userLeftCallbacks","userReturnCallbacks","trackTimeOnElement","elementId","element","document","getElementById","addEventListener","startTimer","stopTimer","getTimeOnElementInSeconds","time","getTimeOnPageInSeconds","pageName","startTime","arrayOfTimes","latestStartStopEntry","length","stopTime","push","Date","stopAllTimers","pageNames","Object","keys","i","getTimeOnCurrentPageInSeconds","timeInMs","getTimeOnPageInMilliseconds","getTimeOnCurrentPageInMilliseconds","totalTimeOnPage","timeSpentOnPageInSeconds","difference","getTimeOnAllPagesInSeconds","allTimes","timeOnPage","setIdleDurationInSeconds","duration","durationFloat","parseFloat","isNaN","name","message","setCurrentPageName","resetRecordedPageTime","resetAllRecordedPageTimes","resetIdleCountdown","triggerUserHasReturned","callWhenUserLeaves","callback","numberOfTimesToInvoke","callWhenUserReturns","userReturnedCallback","numberTimes","triggerUserHasLeftPage","userHasLeftCallback","callAfterTimeElapsedInSeconds","timeInSeconds","pending","checkState","visibilityChangeEventName","hiddenPropName","listenForVisibilityEvents","hidden","mozHidden","msHidden","webkitHidden","window","setInterval","websocket","websocketHost","setUpWebsocket","websocketOptions","WebSocket","onbeforeunload","sendCurrentTime","appId","onopen","sendInitWsRequest","onerror","error","console","log","onmessage","event","data","websocketSend","send","JSON","stringify","timeSpentOnPage","type","timeOnPageMs","initialize","options","idleTimeoutInSeconds","initialStartTime","call"],"mappings":"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","sourcesContent":["/*Copyright (c) 2017 Jason Zissman\nPermission is hereby granted, free of charge, to any person obtaining a copy of\nthis software and associated documentation files (the \"Software\"), to deal in\nthe Software without restriction, including without limitation the rights to\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of\nthe Software, and to permit persons to whom the Software is furnished to do so,\nsubject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\nFOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\nCOPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER\nIN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\nCONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n*/\n\n(function () {\n\t(function (root, factory) {\n\t\tif (typeof module !== 'undefined' && module.exports) {\n\t\t\t// CommonJS\n\t\t\treturn module.exports = factory();\n\t\t} else if (typeof define === 'function' && define.amd) {\n\t\t\t// AMD\n\t\t\tdefine([], function () {\n\t\t\t\treturn (root.TimeMe = factory());\n\t\t\t});\n\t\t} else {\n\t\t\t// Global Variables\n\t\t\treturn root.TimeMe = factory();\n\t\t}\n\t})(this, function () {\n\n\t\tvar TimeMe = {\n\n\t\t\tstartStopTimes: {},\n\t\t\tidleTimeoutMs: 30 * 1000,\n\t\t\tcurrentIdleTimeMs: 0,\n\t\t\tcheckStateRateMs: 250,\n\t\t\tactive: false,\n\t\t\tidle: false,\n\t\t\tcurrentPageName: \"default-page-name\",\n\t\t\ttimeElapsedCallbacks: [],\n\t\t\tuserLeftCallbacks: [],\n\t\t\tuserReturnCallbacks: [],\n\n\t\t\ttrackTimeOnElement: function (elementId) {\n\t\t\t\tvar element = document.getElementById(elementId);\n\t\t\t\tif (element) {\n\t\t\t\t\telement.addEventListener(\"mouseover\", function () {\n\t\t\t\t\t\tTimeMe.startTimer(elementId);\n\t\t\t\t\t});\n\t\t\t\t\telement.addEventListener(\"mousemove\", function () {\n\t\t\t\t\t\tTimeMe.startTimer(elementId);\n\t\t\t\t\t});\t\t\t\t\t\n\t\t\t\t\telement.addEventListener(\"mouseleave\", function () {\n\t\t\t\t\t\tTimeMe.stopTimer(elementId);\n\t\t\t\t\t});\n\t\t\t\t\telement.addEventListener(\"keypress\", function () {\n\t\t\t\t\t\tTimeMe.startTimer(elementId);\n\t\t\t\t\t});\n\t\t\t\t\telement.addEventListener(\"focus\", function () {\n\t\t\t\t\t\tTimeMe.startTimer(elementId);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tgetTimeOnElementInSeconds: function (elementId) {\n\t\t\t\tvar time = TimeMe.getTimeOnPageInSeconds(elementId);\n\t\t\t\tif (time) {\n\t\t\t\t\treturn time;\n\t\t\t\t} else {\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// startTime is optional. If provided, must be of type Date(). By providing\n\t\t\t// startTime, you are overriding the internal timing mechanism and manually\n\t\t\t// indicating the start time.\n\t\t\tstartTimer: function (pageName, startTime) {\n\t\t\t\tif (!pageName) {\n\t\t\t\t\tpageName = TimeMe.currentPageName;\n\t\t\t\t}\n\n\t\t\t\tif (TimeMe.startStopTimes[pageName] === undefined) {\n\t\t\t\t\tTimeMe.startStopTimes[pageName] = [];\n\t\t\t\t} else {\n\t\t\t\t\tvar arrayOfTimes = TimeMe.startStopTimes[pageName];\n\t\t\t\t\tvar latestStartStopEntry = arrayOfTimes[arrayOfTimes.length - 1];\n\t\t\t\t\tif (latestStartStopEntry !== undefined && latestStartStopEntry.stopTime === undefined) {\n\t\t\t\t\t\t// Can't start new timer until previous finishes.\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tTimeMe.startStopTimes[pageName].push({\n\t\t\t\t\t\"startTime\": startTime || new Date(),\n\t\t\t\t\t\"stopTime\": undefined\n\t\t\t\t});\n\t\t\t\tTimeMe.active = true;\n\t\t\t},\n\n\t\t\tstopAllTimers: function () {\n\t\t\t\tvar pageNames = Object.keys(TimeMe.startStopTimes);\n\t\t\t\tfor (var i = 0; i < pageNames.length; i++) {\n\t\t\t\t\tTimeMe.stopTimer(pageNames[i]);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// stopTime is optional. If provided, must be of type Date(). By providing\n\t\t\t// stopTime, you are overriding the internal timing mechanism and manually\n\t\t\t// indicating the stop time.\n\t\t\tstopTimer: function (pageName, stopTime) {\n\t\t\t\tif (!pageName) {\n\t\t\t\t\tpageName = TimeMe.currentPageName;\n\t\t\t\t}\n\t\t\t\tvar arrayOfTimes = TimeMe.startStopTimes[pageName];\n\t\t\t\tif (arrayOfTimes === undefined || arrayOfTimes.length === 0) {\n\t\t\t\t\t// Can't stop timer before you've started it.\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (arrayOfTimes[arrayOfTimes.length - 1].stopTime === undefined) {\n\t\t\t\t\tarrayOfTimes[arrayOfTimes.length - 1].stopTime = stopTime || new Date();\n\t\t\t\t}\n\t\t\t\tTimeMe.active = false;\n\t\t\t},\n\n\t\t\tgetTimeOnCurrentPageInSeconds: function () {\n\t\t\t\treturn TimeMe.getTimeOnPageInSeconds(TimeMe.currentPageName);\n\t\t\t},\n\n\t\t\tgetTimeOnPageInSeconds: function (pageName) {\n\t\t\t\tvar timeInMs = TimeMe.getTimeOnPageInMilliseconds(pageName);\n\t\t\t\tif (timeInMs === undefined) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t} else {\n\t\t\t\t\treturn timeInMs / 1000;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tgetTimeOnCurrentPageInMilliseconds: function () {\n\t\t\t\treturn TimeMe.getTimeOnPageInMilliseconds(TimeMe.currentPageName);\n\t\t\t},\n\n\t\t\tgetTimeOnPageInMilliseconds: function (pageName) {\n\n\t\t\t\tvar totalTimeOnPage = 0;\n\n\t\t\t\tvar arrayOfTimes = TimeMe.startStopTimes[pageName];\n\t\t\t\tif (arrayOfTimes === undefined) {\n\t\t\t\t\t// Can't get time on page before you've started the timer.\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar timeSpentOnPageInSeconds = 0;\n\t\t\t\tfor (var i = 0; i < arrayOfTimes.length; i++) {\n\t\t\t\t\tvar startTime = arrayOfTimes[i].startTime;\n\t\t\t\t\tvar stopTime = arrayOfTimes[i].stopTime;\n\t\t\t\t\tif (stopTime === undefined) {\n\t\t\t\t\t\tstopTime = new Date();\n\t\t\t\t\t}\n\t\t\t\t\tvar difference = stopTime - startTime;\n\t\t\t\t\ttimeSpentOnPageInSeconds += (difference);\n\t\t\t\t}\n\n\t\t\t\ttotalTimeOnPage = Number(timeSpentOnPageInSeconds);\n\t\t\t\treturn totalTimeOnPage;\n\t\t\t},\n\n\t\t\tgetTimeOnAllPagesInSeconds: function () {\n\t\t\t\tvar allTimes = [];\n\t\t\t\tvar pageNames = Object.keys(TimeMe.startStopTimes);\n\t\t\t\tfor (var i = 0; i < pageNames.length; i++) {\n\t\t\t\t\tvar pageName = pageNames[i];\n\t\t\t\t\tvar timeOnPage = TimeMe.getTimeOnPageInSeconds(pageName);\n\t\t\t\t\tallTimes.push({\n\t\t\t\t\t\t\"pageName\": pageName,\n\t\t\t\t\t\t\"timeOnPage\": timeOnPage\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn allTimes;\n\t\t\t},\n\n\t\t\tsetIdleDurationInSeconds: function (duration) {\n\t\t\t\tvar durationFloat = parseFloat(duration);\n\t\t\t\tif (isNaN(durationFloat) === false) {\n\t\t\t\t\tTimeMe.idleTimeoutMs = duration * 1000;\n\t\t\t\t} else {\n\t\t\t\t\tthrow {\n\t\t\t\t\t\tname: \"InvalidDurationException\",\n\t\t\t\t\t\tmessage: \"An invalid duration time (\" + duration + \") was provided.\"\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\tsetCurrentPageName: function (pageName) {\n\t\t\t\tTimeMe.currentPageName = pageName;\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\tresetRecordedPageTime: function (pageName) {\n\t\t\t\tdelete TimeMe.startStopTimes[pageName];\n\t\t\t},\n\n\t\t\tresetAllRecordedPageTimes: function () {\n\t\t\t\tvar pageNames = Object.keys(TimeMe.startStopTimes);\n\t\t\t\tfor (var i = 0; i < pageNames.length; i++) {\n\t\t\t\t\tTimeMe.resetRecordedPageTime(pageNames[i]);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tresetIdleCountdown: function () {\n\t\t\t\tif (TimeMe.idle) {\n\t\t\t\t\tTimeMe.triggerUserHasReturned();\n\t\t\t\t}\n\t\t\t\tTimeMe.idle = false;\n\t\t\t\tTimeMe.currentIdleTimeMs = 0;\n\t\t\t},\n\n\t\t\tcallWhenUserLeaves: function (callback, numberOfTimesToInvoke) {\n\t\t\t\tthis.userLeftCallbacks.push({\n\t\t\t\t\tcallback: callback,\n\t\t\t\t\tnumberOfTimesToInvoke: numberOfTimesToInvoke\n\t\t\t\t})\n\t\t\t},\n\n\t\t\tcallWhenUserReturns: function (callback, numberOfTimesToInvoke) {\n\t\t\t\tthis.userReturnCallbacks.push({\n\t\t\t\t\tcallback: callback,\n\t\t\t\t\tnumberOfTimesToInvoke: numberOfTimesToInvoke\n\t\t\t\t})\n\t\t\t},\n\n\t\t\ttriggerUserHasReturned: function () {\n\t\t\t\tif (!TimeMe.active) {\n\t\t\t\t\tfor (var i = 0; i < this.userReturnCallbacks.length; i++) {\n\t\t\t\t\t\tvar userReturnedCallback = this.userReturnCallbacks[i];\n\t\t\t\t\t\tvar numberTimes = userReturnedCallback.numberOfTimesToInvoke;\n\t\t\t\t\t\tif (isNaN(numberTimes) || (numberTimes === undefined) || numberTimes > 0) {\n\t\t\t\t\t\t\tuserReturnedCallback.numberOfTimesToInvoke -= 1;\n\t\t\t\t\t\t\tuserReturnedCallback.callback();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tTimeMe.startTimer();\n\t\t\t},\n\n\t\t\ttriggerUserHasLeftPage: function () {\n\t\t\t\tif (TimeMe.active) {\n\t\t\t\t\tfor (var i = 0; i < this.userLeftCallbacks.length; i++) {\n\t\t\t\t\t\tvar userHasLeftCallback = this.userLeftCallbacks[i];\n\t\t\t\t\t\tvar numberTimes = userHasLeftCallback.numberOfTimesToInvoke;\n\t\t\t\t\t\tif (isNaN(numberTimes) || (numberTimes === undefined) || numberTimes > 0) {\n\t\t\t\t\t\t\tuserHasLeftCallback.numberOfTimesToInvoke -= 1;\n\t\t\t\t\t\t\tuserHasLeftCallback.callback();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tTimeMe.stopAllTimers();\n\t\t\t},\n\n\t\t\tcallAfterTimeElapsedInSeconds: function (timeInSeconds, callback) {\n\t\t\t\tTimeMe.timeElapsedCallbacks.push({\n\t\t\t\t\ttimeInSeconds: timeInSeconds,\n\t\t\t\t\tcallback: callback,\n\t\t\t\t\tpending: true\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tcheckState: function () {\n\t\t\t\tfor (var i = 0; i < TimeMe.timeElapsedCallbacks.length; i++) {\n\t\t\t\t\tif (TimeMe.timeElapsedCallbacks[i].pending && TimeMe.getTimeOnCurrentPageInSeconds() > TimeMe.timeElapsedCallbacks[i].timeInSeconds) {\n\t\t\t\t\t\tTimeMe.timeElapsedCallbacks[i].callback();\n\t\t\t\t\t\tTimeMe.timeElapsedCallbacks[i].pending = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (TimeMe.idle === false && TimeMe.currentIdleTimeMs > TimeMe.idleTimeoutMs) {\n\t\t\t\t\tTimeMe.idle = true;\n\t\t\t\t\tTimeMe.triggerUserHasLeftPage();\n\t\t\t\t} else {\n\t\t\t\t\tTimeMe.currentIdleTimeMs += TimeMe.checkStateRateMs;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tvisibilityChangeEventName: undefined,\n\t\t\thiddenPropName: undefined,\n\n\t\t\tlistenForVisibilityEvents: function () {\n\n\t\t\t\tif (typeof document.hidden !== \"undefined\") {\n\t\t\t\t\tTimeMe.hiddenPropName = \"hidden\";\n\t\t\t\t\tTimeMe.visibilityChangeEventName = \"visibilitychange\";\n\t\t\t\t} else if (typeof document.mozHidden !== \"undefined\") {\n\t\t\t\t\tTimeMe.hiddenPropName = \"mozHidden\";\n\t\t\t\t\tTimeMe.visibilityChangeEventName = \"mozvisibilitychange\";\n\t\t\t\t} else if (typeof document.msHidden !== \"undefined\") {\n\t\t\t\t\tTimeMe.hiddenPropName = \"msHidden\";\n\t\t\t\t\tTimeMe.visibilityChangeEventName = \"msvisibilitychange\";\n\t\t\t\t} else if (typeof document.webkitHidden !== \"undefined\") {\n\t\t\t\t\tTimeMe.hiddenPropName = \"webkitHidden\";\n\t\t\t\t\tTimeMe.visibilityChangeEventName = \"webkitvisibilitychange\";\n\t\t\t\t}\n\n\t\t\t\tdocument.addEventListener(TimeMe.visibilityChangeEventName, function () {\n\t\t\t\t\tif (document[TimeMe.hiddenPropName]) {\n\t\t\t\t\t\tTimeMe.triggerUserHasLeftPage();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tTimeMe.triggerUserHasReturned();\n\t\t\t\t\t}\n\t\t\t\t}, false);\n\n\t\t\t\twindow.addEventListener('blur', function () {\n\t\t\t\t\tTimeMe.triggerUserHasLeftPage();\n\t\t\t\t});\n\n\t\t\t\twindow.addEventListener('focus', function () {\n\t\t\t\t\tTimeMe.triggerUserHasReturned();\n\t\t\t\t});\n\n\t\t\t\tdocument.addEventListener(\"mousemove\", function () { TimeMe.resetIdleCountdown(); });\n\t\t\t\tdocument.addEventListener(\"keyup\", function () { TimeMe.resetIdleCountdown(); });\n\t\t\t\tdocument.addEventListener(\"touchstart\", function () { TimeMe.resetIdleCountdown(); });\n\t\t\t\twindow.addEventListener(\"scroll\", function () { TimeMe.resetIdleCountdown(); });\n\n\t\t\t\tsetInterval(function () {\n\t\t\t\t\tTimeMe.checkState();\n\t\t\t\t}, TimeMe.checkStateRateMs);\n\t\t\t},\n\n\t\t\twebsocket: undefined,\n\n\t\t\twebsocketHost: undefined,\n\n\t\t\tsetUpWebsocket: function (websocketOptions) {\n\t\t\t\tif (window.WebSocket && websocketOptions) {\n\t\t\t\t\tvar websocketHost = websocketOptions.websocketHost; // \"ws://hostname:port\"\n\t\t\t\t\ttry {\n\t\t\t\t\t\tTimeMe.websocket = new WebSocket(websocketHost);\n\t\t\t\t\t\twindow.onbeforeunload = function (event) {\n\t\t\t\t\t\t\tTimeMe.sendCurrentTime(websocketOptions.appId);\n\t\t\t\t\t\t};\n\t\t\t\t\t\tTimeMe.websocket.onopen = function () {\n\t\t\t\t\t\t\tTimeMe.sendInitWsRequest(websocketOptions.appId);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tTimeMe.websocket.onerror = function (error) {\n\t\t\t\t\t\t\tif (console) {\n\t\t\t\t\t\t\t\tconsole.log(\"Error occurred in websocket connection: \" + error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tTimeMe.websocket.onmessage = function (event) {\n\t\t\t\t\t\t\tif (console) {\n\t\t\t\t\t\t\t\tconsole.log(event.data);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tif (console) {\n\t\t\t\t\t\t\tconsole.error(\"Failed to connect to websocket host.  Error:\" + error);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\twebsocketSend: function (data) {\n\t\t\t\tTimeMe.websocket.send(JSON.stringify(data));\n\t\t\t},\n\n\t\t\tsendCurrentTime: function (appId) {\n\t\t\t\tvar timeSpentOnPage = TimeMe.getTimeOnCurrentPageInMilliseconds();\n\t\t\t\tvar data = {\n\t\t\t\t\ttype: \"INSERT_TIME\",\n\t\t\t\t\tappId: appId,\n\t\t\t\t\ttimeOnPageMs: timeSpentOnPage,\n\t\t\t\t\tpageName: TimeMe.currentPageName\n\t\t\t\t};\n\t\t\t\tTimeMe.websocketSend(data);\n\t\t\t},\n\t\t\tsendInitWsRequest: function (appId) {\n\t\t\t\tvar data = {\n\t\t\t\t\ttype: \"INIT\",\n\t\t\t\t\tappId: appId\n\t\t\t\t};\n\t\t\t\tTimeMe.websocketSend(data);\n\t\t\t},\n\n\t\t\tinitialize: function (options) {\n\n\t\t\t\tvar idleTimeoutInSeconds = TimeMe.idleTimeoutMs || 30;\n\t\t\t\tvar currentPageName = TimeMe.currentPageName || \"default-page-name\";\n\t\t\t\tvar websocketOptions = undefined;\n\t\t\t\tvar initialStartTime = undefined;\n\n\t\t\t\tif (options) {\n\t\t\t\t\tidleTimeoutInSeconds = options.idleTimeoutInSeconds || idleTimeoutInSeconds;\n\t\t\t\t\tcurrentPageName = options.currentPageName || currentPageName;\n\t\t\t\t\twebsocketOptions = options.websocketOptions;\n\t\t\t\t\tinitialStartTime = options.initialStartTime;\n\t\t\t\t}\n\n\t\t\t\tTimeMe.setIdleDurationInSeconds(idleTimeoutInSeconds)\n\t\t\t\t\t.setCurrentPageName(currentPageName)\n\t\t\t\t\t.setUpWebsocket(websocketOptions)\n\t\t\t\t\t.listenForVisibilityEvents();\n\n\t\t\t\t// TODO - only do this if page currently visible.\n\n\t\t\t\tTimeMe.startTimer(undefined, initialStartTime);\n\t\t\t}\n\t\t};\n\t\treturn TimeMe;\n\t});\n}).call(this);"],"file":"timeme.min.js"}
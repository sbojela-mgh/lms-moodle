define ("block_learnerscript/smartfilter",["jquery","block_learnerscript/ajax","block_learnerscript/reportwidget","block_learnerscript/report","block_learnerscript/jquery.serialize-object"],function(a,b){var c=a(".basicparamsform #id_filter_courses"),d=a(".basicparamsform #id_filter_users"),e=a(".basicparamsform #id_filter_activities"),f=a(".filterform #id_filter_courses"),g=a(".filterform #id_filter_users"),h=a(".filterform #id_filter_activities");return smartfilter={DurationFilter:function DurationFilter(b,c){var d=new Date,e=d.getFullYear()+"/"+(d.getMonth()+1)+"/"+d.getDate(),f="";if("clear"!==b){a("#ls_fenddate").val(d.getTime()/1e3);switch(b){case"week":f=new Date(d.getFullYear(),d.getMonth(),d.getDate()-7);break;case"month":f=new Date(d.getFullYear(),d.getMonth()-1,d.getDate());break;case"year":f=new Date(d.getFullYear()-1,d.getMonth(),d.getDate());break;case"custom":a("#customrange").show();break;default:break;}if(""!=f){a("#ls_fstartdate").val(f.getTime()/1e3)}}else{a("#ls_fenddate").val("");a("#ls_fstartdate").val("")}if("custom"!==b){var g=a("input[name=\"reportid\"]").val();if(!1!=c){require(["block_learnerscript/reportwidget"],function(a){a.DashboardTiles();a.DashboardWidgets()})}else{require(["block_learnerscript/report"],function(a){a.CreateReportPage({reportid:g,instanceid:g,reportdashboard:c})})}a("#customrange").val("");a("#customrange").hide()}if(!0!=c){var g=a("input[name=\"reportid\"]").val();a(".plotgraphcontainer").removeClass("show").addClass("hide");a("#plotreportcontainer"+g).html("")}},FilterData:function FilterData(b){var c=a(".filterform"+b).serializeObject();a.urlParam=function(a){var b=new RegExp("[?&]"+a+"=([^&#]*)").exec(window.location.href);if(null===b||" "==b){return null}else{return b[1]||0}};var d=a.urlParam("dashboardurl");if("Course"==d){var e=a(".report_courses").val();c.filter_courses=e}return c},BasicparamsData:function BasicparamsData(b){var c=a(".basicparamsform"+b).serializeObject();return c},CourseData:function CourseData(a){var b=!1;if(0<e.length||0<h.length){if(0<e.length){b=!0}if(0<a.courseid){this.CourseActivities({courseid:a.courseid,firstelementactive:b,activityid:a.filterrequests.filter_activities})}}if(0<d.length||0<g.length){if(0<d.length){b=!0}}},categoryCourses:function categoryCourses(c){var d=a("#id_filter_coursecategories").find(":selected").val();if(0<d){var e=b.call({args:{action:"categorycourses",basicparam:!0,reporttype:c.reporttype,categoryid:c.categoryid},url:M.cfg.wwwroot+"/blocks/learnerscript/ajax.php"});e.done(function(b){var c="";a.each(b,function(a,b){c+="<option value = "+a+">"+b+"</option>"});a("#id_filter_courses").html(c)})}},CourseActivities:function CourseActivities(c){var d=c.element||a("#id_filter_activities");activityid=parseInt(c.activityid)||0;d.val();d.find("option").remove().end().append("<option value=0>Select Activity</option>");if(0<=c.courseid){var e=b.call({args:{action:"courseactivities",basicparam:!0,courseid:c.courseid},url:M.cfg.wwwroot+"/blocks/learnerscript/ajax.php"});e.done(function(b){a.each(b,function(b,c){b=parseInt(b);if(0==b){return!0}if(b!=activityid){d.append(a("<option></option>").attr("value",b).text(c))}else{d.append(a("<option></option>").attr("value",b).attr("selected","selected").text(c))}});var e=a(".basicparamsform #id_filter_activities").find(":selected").val();if(0==e||null==e){a(".basicparamsform #id_filter_activities").val(a(".basicparamsform #id_filter_activities option:eq(1)").val())}var f=d.parents(".basicparamsform").length;if(0<f&&c.onloadtrigger){a(".basicparamsform #id_filter_apply").trigger("click")}})}},UserCourses:function UserCourses(c){var d=a("#id_filter_courses").find(":selected").val();a("#id_filter_courses").find("option").remove().end().append("<option value=\"\">Select Course</option>");if(0<=c.userid){var e=b.call({args:{action:"usercourses",basicparam:!0,userid:c.userid,reporttype:c.reporttype,reportid:c.reportid},url:M.cfg.wwwroot+"/blocks/learnerscript/ajax.php"});e.done(function(b){a.each(b,function(e,f){if(0==e){return!0}if(e==Object.keys(b)[0]&&1==c.firstelementactive||e==d&&1==c.firstelementactive){a("#id_filter_courses").append(a("<option></option>").attr("value",e).attr("selected","selected").text(f));if("undefined"!=typeof c.triggercourseactivities&&!0==c.triggercourseactivities){smartfilter.CourseActivities({courseid:e})}}else{a("#id_filter_courses").append(a("<option></option>").attr("value",e).text(f))}})})}},EnrolledUsers:function EnrolledUsers(c){var d=c.element||a("#id_filter_users"),e=d.val();d.find("option").remove().end().append("<option value=\"\">Select User</option>");var f=b.call({args:{action:"enrolledusers",basicparam:!0,reportid:c.reportid,courseid:c.courseid,reporttype:c.reporttype,component:c.components},url:M.cfg.wwwroot+"/blocks/learnerscript/ajax.php"});f.done(function(b){a.each(b,function(b,c){if(0==b){return!0}if(b!=e){d.append(a("<option></option>").attr("value",b).text(c))}else{d.append(a("<option></option>").attr("value",b).attr("selected","selected").text(c))}});if(!!b.hasOwnProperty(e)){d.select2("val","");var f=d.parents(".basicparamsform").length;if(0<f&&c.onloadtrigger){a(".basicparamsform #id_filter_apply").trigger("click")}}})},CohortUsers:function CohortUsers(c){var d=a("#id_filter_cohort").find(":selected").val();if(0<d){var e=b.call({args:{action:"cohortusers",basicparam:!0,reporttype:c.reporttype,categoryid:c.cohortid},url:M.cfg.wwwroot+"/blocks/learnerscript/ajax.php"});e.done(function(b){var c="";a.each(b,function(a,b){c+="<option value = "+a+">"+b+"</option>"});a("#id_filter_users").html(c)})}}}});
//# sourceMappingURL=smartfilter.min.js.map

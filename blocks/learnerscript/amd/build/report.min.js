define ("block_learnerscript/report",["block_learnerscript/select2","block_learnerscript/responsive.bootstrap","block_learnerscript/reportwidget","block_learnerscript/chart","block_learnerscript/smartfilter","block_learnerscript/helper","block_learnerscript/ajaxforms","block_learnerscript/ajax","jquery","block_learnerscript/radioslider","block_learnerscript/flatpickr","core/templates","jqueryui"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m,n=i(".basicparamsform #id_filter_courses"),o=i(".basicparamsform #id_filter_users"),p=i(".basicparamsform #id_filter_activities"),q=i(".filterform #id_filter_courses"),r=i(".filterform #id_filter_users"),s=i(".filterform #id_filter_activities"),t=i(".filterform #id_filter_modules"),u=i(".filterform #id_filter_cohort"),v=0;return m={init:function init(a){i.ui.dialog.prototype._focusTabbable=i.noop;i.fn.dataTable.ext.errMode="none";i(".plotgraphcontainer").on("click",function(){var a=i(this).data("reportid");i(".plotgraphcontainer").removeClass("show").addClass("hide");i("#plotreportcontainer"+a).html("")});i("select[data-select2='1']").select2({theme:"classic"}).on("select2:selecting",function(a){if(i(this).val()&&i(this).data("maximumSelectionLength")&&i(this).val().length>=i(this).data("maximumSelectionLength")){a.preventDefault();i(this).select2("close")}});i("#reportsearch").val(a.reportid).trigger("change.select2");i("#reportsearch").change(function(){var a=i(this).find(":selected").val();window.location=M.cfg.wwwroot+"/blocks/learnerscript/viewreport.php?id="+a});j.init(i("#segmented-button"),{size:"medium",animation:!0,reportdashboard:!1});k("#customrange",{mode:"range",onOpen:function onOpen(a,b,c){c.clear()},onClose:function onClose(b){if(0!==b.length){i("#ls_fstartdate").val(b[0].getTime()/1e3);i("#ls_fenddate").val(b[1].getTime()/1e3+86400);require(["block_learnerscript/report"],function(b){b.CreateReportPage({reportid:a.reportid,instanceid:a.reportid,reportdashboard:!1})})}}});i("#id_filter_cohort").change(function(){var c=i(this).find(":selected").val();if(0<c&&(0<r.length||0<o.length)){if(0<o.length){b=!0}e.CohortUsers({cohortid:c,reporttype:a.reporttype,reportid:a.reportid,firstelementactive:b})}});if("undefined"!=typeof n||"undefined"!=typeof q){i("#id_filter_courses").change(function(){a.courseid=i(this).find(":selected").val();e.CourseData(a)})}i("#id_filter_users").change(function(){var a=i(this).find(":selected").val();if(0<a&&(0<q.length||0<n.length)){if(0<n.length){b=!0}}});i("#id_filter_coursecategories").change(function(){var b=i(this).find(":selected").val();e.categoryCourses({categoryid:b,reporttype:a.reporttype})});schedule.SelectRoleUsers();if(null!=a.basicparams){if("courses"==a.basicparams[0].name){i("#id_filter_courses").trigger("change");v++}}if(null!=a.basicparams){var b=!1;if("users"==a.basicparams[0].name){if(0<n.length){b=!0}var c=i("#id_filter_users").find(":selected").val();if(0<c){a.courseid=i("#id_filter_courses").find(":selected").val();e.CourseData(a)}}}i(".filterform"+a.reportid+" .fitemtitle").hide();i(".filterform"+a.reportid+" .felement").attr("style","margin:0");i(".basicparamsform"+a.reportid+" .fitemtitle").hide();i(".basicparamsform"+a.reportid+" .felement").attr("style","margin:0");i(".filterform #id_filter_clear").click(function(){i(".filterform"+a.reportid).trigger("reset");i(this).parent().find("#id_filter_activities");if(0<r.length){if(0<q.length||0<n.length){if(0<n.length){b=!0}}}if(0<q.length){if(0<r.length||0<o.length){}if(0<s.length||0<p.length){e.CourseActivities({courseid:0})}}if(0<s.length||0<t.length){if((0<q.length||0<n.length)&&0==o.length){if(0<n.length&&0==o.length){b=!0}}if(0<n.length&&0<o.length){i(".basicparamsform #id_filter_apply").trigger("click",[!0])}}if(0<u.length){if(0<r.length){e.CohortUsers({cohortid:0})}}if(0<i(".basicparamsform #id_filter_apply").length){i(document).ajaxComplete(function(){});i(".basicparamsform #id_filter_apply").trigger("click",[!0])}else{a.reporttype=i(".ls-plotgraphs_listitem.ui-tabs-active").data("cid");m.CreateReportPage({reportid:a.reportid,reporttype:a.reporttype,instanceid:a.reportid})}i(".filterform select[data-select2='1']").select2("destroy").select2({theme:"classic"});i(".filterform select[data-select2-ajax='1']").val("0").trigger("change");i(".filterform")[0].reset();i(".filterform #id_filter_clear").attr("disabled","disabled");i(".plotgraphcontainer").removeClass("show").addClass("hide");i("#plotreportcontainer"+a.instanceid).html("")});i(".basicparamsform #id_filter_apply,.filterform #id_filter_apply").click(function(b,c){var d=f.validatebasicform(c);b.preventDefault();b.stopImmediatePropagation();i(".filterform"+a.reportid).show();a.instanceid=a.reportid;if("Get Report"!=b.currentTarget.value){i(".filterform #id_filter_clear").removeAttr("disabled")}if(-1!=i.inArray(0,d)){i("#report_plottabs").hide();i("#reportcontainer"+a.reportid).html("<div class='alert alert-info'>No data available</div>")}else{i("#report_plottabs").show();a.reporttype=i(".ls-plotgraphs_listitem.ui-tabs-active").data("cid");m.CreateReportPage({reportid:a.reportid,reporttype:a.reporttype,instanceid:a.instanceid,reportdashboard:!1})}i(".plotgraphcontainer").removeClass("show").addClass("hide");i("#plotreportcontainer"+a.instanceid).html("")});if(null==a.basicparams){m.CreateReportPage({reportid:a.reportid,reporttype:a.reporttype,instanceid:a.reportid,reportdashboard:!1})}else{if(4>=a.basicparams.length){i(".basicparamsform #id_filter_apply").trigger("click",[!0])}else{i(document).ajaxComplete(function(b,c,d){if(0<d.url.indexOf("blocks/learnerscript/ajax.php")){if("undefined"!=typeof d.data){var e=i.parseJSON(d.data);if("undefined"!=typeof e.basicparam&&!0==e.basicparam){v++}}if(a.basicparams.length==v&&"plotforms"!=e.action&&"pluginlicence"!=e.action){i(".basicparamsform #id_filter_apply").trigger("click",[!0])}}})}}},CreateReportPage:function CreateReportPage(a){var b=0;if(!1==a.reportdashboard){var b=i("#disabletable").val();if(b){a.reporttype=i(i(".ls-plotgraphs_listitem")[0]).data("cid")}}if(1==b&&0<a.reporttype.length){d.HighchartsAjax({reportid:a.reportid,action:"generate_plotgraph",cols:a.cols,reporttype:a.reporttype})}else if(0==b){c.CreateDashboardwidget({reportid:a.reportid,reporttype:"table",instanceid:a.reportid,reportdashboard:a.reportdashboard})}},generate_plotgraph:function generate_plotgraph(a){a.containerid="plotreportcontainer"+a.reportinstance;switch(a.type){case"pie":d.piechart(a);break;case"spline":case"bar":case"column":d.lbchart(a);break;case"solidgauge":d.solidgauge(a);break;case"combination":d.combinationchart(a);break;case"map":d.WorldMap(a);break;case"treemap":d.TreeMap(a);break;}},ReportDatatable:function ReportDatatable(a){var b=this,c={},g=a.instanceid?a.instanceid:a.reportid;c.filters=a.filters;c.basicparams=a.basicparams||JSON.stringify(e.BasicparamsData(g));c.reportid=a.reportid;c.columns=a.columns;i.fn.dataTable.pipeline=function(b){var c=i.extend({url:"",data:null,method:"POST"},b);return function(b,d,e){var f=b.start,g=b.start,h=b.length;if("undefined"!=typeof a.data&&1==b.draw){json=a.data;json.draw=b.draw;json.data.splice(0,f);json.data.splice(h,json.data.length);d(json)}else{b.start=f;b.length=h;i.extend(b,c.data);e.jqXHR=i.ajax({type:c.method,url:c.url,data:b,dataType:"json",cache:!1,success:function success(a){d(a)}})}}};if("Users profile"==a.reportname||"Course profile"==a.reportname){var h=[[50,100,-1],["Show 50","Show 100","Show All"]]}else{var h=[[10,25,50,100,-1],["Show 10","Show 25","Show 50","Show 100","Show All"]]}i("#reporttable_"+g).DataTable({processing:!0,serverSide:!0,destroy:!0,dom:"<\"co_report_header\"Bf <\"report_header_skew\"  <\"report_header_skew_content\" Bl<\"report_header_showhide\" ><\"report_calculation_showhide\" >> > > tr <\"co_report_footer\"ip>",ajax:i.fn.dataTable.pipeline({type:"POST",url:M.cfg.wwwroot+"/blocks/learnerscript/components/datatable/server_processing.php?sesskey="+M.cfg.sesskey,data:c}),columnDefs:a.columnDefs,fnDrawCallback:function fnDrawCallback(){d.SparkLineReport();f.DrilldownReport()},oScroll:{},responsive:!0,fnInitComplete:function fnInitComplete(){this.fnAdjustColumnSizing(!0);if("Users profile"==a.reportname||"Course profile"==a.reportname){i("#reporttable_"+g+"_wrapper .co_report_header").remove();i("#reporttable_"+g+"_wrapper .co_report_footer").remove()}i(".download_menu"+g+" li a").each(function(){var b=i(this).attr("href");if("undefined"!=typeof a.basicparams){var c=JSON.parse(a.basicparams);i.each(c,function(a,c){if(0==a.indexOf("filter_")){b+="&"+a+"="+c}})}if("undefined"!=typeof a.filters){var d=JSON.parse(a.filters);i.each(d,function(a,c){if(0==a.indexOf("filter_")){b+="&"+a+"="+c}if(0==a.indexOf("ls_")){b+="&"+a+"="+c}})}i(this).attr("href",b)})},fnRowCallback:function fnRowCallback(b){i(b).children().each(function(b,c){i(c).css("word-break",a.columnDefs[b].wrap);i(c).css("width",a.columnDefs[b].width)});return b},autoWidth:!1,aaSorting:[],language:{paginate:{previous:"<",next:">"},sProcessing:"<img src='"+M.util.image_url("loading","block_learnerscript")+"'>",search:"_INPUT_",searchPlaceholder:"Search",lengthMenu:"_MENU_",emptyTable:"<div class='alert alert-info'>No data available</div>"},lengthMenu:h});i(".drilldown"+g+" .ui-dialog-title").html(a.reportname);i("#page-blocks-learnerscript-viewreport #reporttable_"+a.reportid+"_wrapper div.report_header_showhide").html(i("#export_options"+a.reportid).html());if(0<i(".reportcalculation"+a.reportid).length){i("#page-blocks-learnerscript-viewreport #reporttable_"+a.reportid+"_wrapper div.report_calculation_showhide").html("<img src=\""+M.util.image_url("calculationicon","block_learnerscript")+"\" onclick=\"(function(e){ require('block_learnerscript/helper').reportCalculations({reportid:"+a.reportid+"}) })(event)\" title =\"Calculations\" />")}},AddExpressions:function AddExpressions(a,b){i(a.target).on("select2:unselecting",function(a){i("#fitem_id_"+a.params.args.data.id+"").remove()});var c=i(a.target).val();i.each(c,function(a){if(0<i("#fitem_id_"+c[a]).length){return}var d=[];d.name=c[a];d.conditionsymbols=[];i.each(["=",">","<",">=","<=","<>"],function(a,b){d.conditionsymbols.push({value:b})});l.render("block_learnerscript/plotconditions",{column:d}).then(function(a){if("yaxisbarvalue"==b){i("#yaxis_bar1").append(a)}else{i("#yaxis1").append(a)}}).fail(function(){})})},block_statistics_help:function block_statistics_help(a){var b=h.call({args:{action:"learnerscriptdata",reportid:a},url:M.cfg.wwwroot+"/blocks/learnerscript/ajax.php"});b.done(function(a){require(["core/modal_factory"],function(b){b.create({title:a.name,body:a.summary,footer:""}).done(function(a){dialogue=a;ModalEvents=require("core/modal_events");dialogue.getRoot().on(ModalEvents.hidden,function(){});dialogue.show()})})})}}});
//# sourceMappingURL=report.min.js.map

define ("block_learnerscript/ajaxforms",["jquery","core/str","core/modal_factory","core/modal_events","core/fragment","block_learnerscript/ajax","block_learnerscript/schedule","block_learnerscript/select2","core/yui","core/templates","core/modal","block_learnerscript/helper","jqueryui"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=function(a,b){this.args=a;this.contextid=1;this.url=b;this.nodeContent=a.nodeContent||"ajaxForm";this.init(this.args)};m.prototype.modal=null;m.prototype.contextid=-1;m.prototype.init=function(b){var c=this.getBody(),d=this,e="";c.done(function(c){a("body").append("<div class='"+d.nodeContent+"'></div>");j.replaceNodeContents("."+d.nodeContent,c.html,"");var f="",h="#viewreport"+b.reportid,i="80%",k="center top",m="center top";if("schreportform"==b.action){e="schreportform";f="<img class='dialog_title_icon' alt='Schedule' src='"+M.util.image_url("schreportform","block_learnerscript")+"' />";h="#inst"+b.instanceid;i="60%";k="center";m="center"}else if("advancedcolumns"==b.action){e="advancedcolumns";h=".ls_components";i="60%";k="center top";m="center top"}else if("sendreportemail"==b.action){e="sendreportemail";f="<img class='dialog_title_icon' alt='Email' src='"+M.util.image_url("email_icon","block_learnerscript")+"'/>";h="#inst"+b.instanceid;i="60%";k="center";m="center"}a("head").append(c.javascript);var n=a("."+d.nodeContent).dialog({resizable:!0,autoOpen:!1,width:i,dialogClass:e,title:d.args.title,modal:!0,appendTo:h,position:{my:k,at:m,of:h,within:h},close:function close(){a(this).dialog("destroy").remove()},open:function open(){a(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");var b=a(".ui-icon-closethick").parent();a(b).attr({title:"Close"});a(this).closest(".ui-dialog").find(".ui-dialog-title").html(f+d.args.title)}});if("schreportform"==b.action){a("."+d.nodeContent+" select[data-select2='1']").select2();g.SelectRoleUsers()}else if("sendreportemail"==b.action){l=require("block_learnerscript/helper");l.Select2Ajax({action:"userlist",reportid:b.reportid,maximumSelectionLength:0})}a("."+d.nodeContent+" .mform").bind("submit",function(a){a.preventDefault();return d.submitFormAjax(this)});if("plotforms"==b.action&&("bar"==b.pname||"column"==b.pname||"line"==b.pname||"combination"==b.pname)){a("."+d.nodeContent+" select[data-select2='1']").select2({theme:"classic"});a(document).on("click",".fa-eye",function(b){b.stopImmediatePropagation();a(b.target).parents(".form-group").find("*").attr("disabled",!0);a(b.target).switchClass("fa-eye","fa-eye-slash");a(b.target).attr("title","Enable")});a(document).on("click",".fa-eye-slash",function(b){b.stopImmediatePropagation();a(b.target).parents(".form-group").find("*").removeAttr("disabled");a(b.target).switchClass("fa-eye-slash","fa-eye");a(b.target).attr("title","Disable")});a(document).on("change","#id_calcs",function(){var b=a(this).val();if(b){a("#id_columnsort").prop("disabled",!0);a("#id_sorting").prop("disabled",!0);a("#id_limit").prop("disabled",!0)}else{a("#id_columnsort").prop("disabled",!1);a("#id_sorting").prop("disabled",!1);a("#id_limit").prop("disabled",!1)}})}n.dialog("open")}).fail(function(){})};m.prototype.getBody=function(a){if("undefined"==typeof a){a=null}else{this.args.jsonformdata=JSON.stringify(a)}var b=f.call({args:this.args,url:this.url},!1);return b};m.prototype.handleFormSubmissionResponse=function(c){var d=require("block_learnerscript/helper");if(c.formerror){j.replaceNodeContents("."+this.nodeContent,c.html,"");a("head").append(c.javascript);var f=this;a("."+this.nodeContent+" .mform").bind("submit",function(a){a.preventDefault();f.submitFormAjax(this)});if("schreportform"==this.args.action){a("."+f.nodeContent+" select[data-select2='1']").select2();g.SelectRoleUsers()}else if("sendreportemail"==this.args.action){d=require("block_learnerscript/helper");d.Select2Ajax({action:"userlist",reportid:this.args.reportid,maximumSelectionLength:0})}else{a("."+f.nodeContent+" select[data-select2='1']").select2({theme:"classic"})}}else{if("columns"==this.args.component){var h=angular.element(".simpleDemo").scope(),i=this.args.advancedcolumn;h.$apply(function(){var a={id:c.data.id};delete c.data.id;a.pluginname=i;a.pluginfullname=i;a.summary="";a.type="selectedcolumns";a.formdata=c.data;h.lists.columns.elements.push(a)});a("."+this.nodeContent).dialog("destroy").remove()}else{if("schreportform"==this.args.action){a("."+this.nodeContent).dialog("close");b.get_string("reportschedule","block_learnerscript").then(function(a){d.notifications(a)})}else if("plotforms"==this.args.action){var f=this;a("."+this.nodeContent).dialog("close");b.get_strings([{key:"graphcreated",component:"block_learnerscript"},{key:"graphupdated",component:"block_learnerscript"}]).then(function(e){var g,h,i;if("add"==f.args.type){d.notifications(e[0]);var k=f.args.reportid;g=c.data.id;var l={reportid:k,chartid:c.data.id,reporttype:c.data.id,pluginname:f.args.pname,chartname:c.data.chartname,issiteadmin:!0,editicon:M.util.image_url("t/edit")};b.get_string(f.args.pname,"block_learnerscript").then(function(a){l.title=a});l.cid=c.data.id;l.pname=f.args.pname;l.type="edit";l.deleteicon=M.util.image_url("t/delete");l.pname=f.args.pname;l.type="edit";if(0<a("#report_plottabs").length){h="block_learnerscript/tabs";i=l}else{h="block_learnerscript/plottabs";i={reportid:k,multiplot:!0,enableplots:!1,plottabs:l}}j.render(h,i).done(function(b){if(0<a("#report_plottabs").length){a("span#report_plottabs ul").append(b)}else{a("span.filter_buttons").prepend(b)}a(".plotgraphcontainer").removeClass("show").addClass("hide");a("#plotreportcontainer"+k).html("")})}else if("edit"==f.args.type){d.notifications(e[1]);g=f.args.cid;a("#lschartname"+g).text(c.data.chartname);a("#"+g).trigger("click")}})}else if("sendreportemail"==this.args.action){a("."+this.nodeContent).dialog("close");b.get_string("mailscheduled","block_learnerscript").then(function(a){d.notifications(a)})}else{window.location.reload()}}}};m.prototype.handleFormSubmissionFailure=function(){};m.prototype.submitFormAjax=function(b){if(skipClientValidation){a("."+this.nodeContent).dialog("destroy").remove();return!0}this.args.jsonformdata=a(b).serialize();var c=this,d=f.call({args:this.args,url:this.url});d.done(function(a){return c.handleFormSubmissionResponse(a)}).fail(function(a){console.log(a)})};m.prototype.submitForm=function(a){a.preventDefault();this.modal.getRoot().find("form").submit()};return{init:function init(a,b){return new m(a,b)}}});
//# sourceMappingURL=ajaxforms.min.js.map

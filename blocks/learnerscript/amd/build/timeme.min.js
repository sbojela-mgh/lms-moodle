(function(){(function(a,b){if("undefined"!=typeof module&&module.exports){return module.exports=b()}else if("function"==typeof define&&define.amd){define ("block_learnerscript/timeme",[],function(){return a.TimeMe=b()})}else{return a.TimeMe=b()}})(this,function(){var a={startStopTimes:{},idleTimeoutMs:30000,currentIdleTimeMs:0,checkStateRateMs:250,active:!1,idle:!1,currentPageName:"default-page-name",timeElapsedCallbacks:[],userLeftCallbacks:[],userReturnCallbacks:[],trackTimeOnElement:function trackTimeOnElement(b){var c=document.getElementById(b);if(c){c.addEventListener("mouseover",function(){a.startTimer(b)});c.addEventListener("mousemove",function(){a.startTimer(b)});c.addEventListener("mouseleave",function(){a.stopTimer(b)});c.addEventListener("keypress",function(){a.startTimer(b)});c.addEventListener("focus",function(){a.startTimer(b)})}},getTimeOnElementInSeconds:function getTimeOnElementInSeconds(b){var c=a.getTimeOnPageInSeconds(b);if(c){return c}else{return 0}},startTimer:function startTimer(b,c){if(!b){b=a.currentPageName}if(a.startStopTimes[b]===void 0){a.startStopTimes[b]=[]}else{var d=a.startStopTimes[b],e=d[d.length-1];if(e!==void 0&&e.stopTime===void 0){return}}a.startStopTimes[b].push({startTime:c||new Date,stopTime:void 0});a.active=!0},stopAllTimers:function stopAllTimers(){for(var b=Object.keys(a.startStopTimes),c=0;c<b.length;c++){a.stopTimer(b[c])}},stopTimer:function stopTimer(b,c){if(!b){b=a.currentPageName}var d=a.startStopTimes[b];if(d===void 0||0===d.length){return}if(d[d.length-1].stopTime===void 0){d[d.length-1].stopTime=c||new Date}a.active=!1},getTimeOnCurrentPageInSeconds:function getTimeOnCurrentPageInSeconds(){return a.getTimeOnPageInSeconds(a.currentPageName)},getTimeOnPageInSeconds:function getTimeOnPageInSeconds(b){var c=a.getTimeOnPageInMilliseconds(b);if(c===void 0){}else{return c/1e3}},getTimeOnCurrentPageInMilliseconds:function getTimeOnCurrentPageInMilliseconds(){return a.getTimeOnPageInMilliseconds(a.currentPageName)},getTimeOnPageInMilliseconds:function getTimeOnPageInMilliseconds(b){var c=0,d=a.startStopTimes[b];if(d===void 0){return}for(var e=0,f=0;f<d.length;f++){var g=d[f].startTime,h=d[f].stopTime;if(h===void 0){h=new Date}var j=h-g;e+=j}c=+e;return c},getTimeOnAllPagesInSeconds:function getTimeOnAllPagesInSeconds(){for(var b=[],c=Object.keys(a.startStopTimes),d=0;d<c.length;d++){var e=c[d],f=a.getTimeOnPageInSeconds(e);b.push({pageName:e,timeOnPage:f})}return b},setIdleDurationInSeconds:function setIdleDurationInSeconds(b){var c=parseFloat(b);if(!1===isNaN(c)){a.idleTimeoutMs=1e3*b}else{throw{name:"InvalidDurationException",message:"An invalid duration time ("+b+") was provided."}}return this},setCurrentPageName:function setCurrentPageName(b){a.currentPageName=b;return this},resetRecordedPageTime:function resetRecordedPageTime(b){delete a.startStopTimes[b]},resetAllRecordedPageTimes:function resetAllRecordedPageTimes(){for(var b=Object.keys(a.startStopTimes),c=0;c<b.length;c++){a.resetRecordedPageTime(b[c])}},resetIdleCountdown:function resetIdleCountdown(){if(a.idle){a.triggerUserHasReturned()}a.idle=!1;a.currentIdleTimeMs=0},callWhenUserLeaves:function callWhenUserLeaves(a,b){this.userLeftCallbacks.push({callback:a,numberOfTimesToInvoke:b})},callWhenUserReturns:function callWhenUserReturns(a,b){this.userReturnCallbacks.push({callback:a,numberOfTimesToInvoke:b})},triggerUserHasReturned:function triggerUserHasReturned(){if(!a.active){for(var b=0;b<this.userReturnCallbacks.length;b++){var c=this.userReturnCallbacks[b],d=c.numberOfTimesToInvoke;if(isNaN(d)||d===void 0||0<d){c.numberOfTimesToInvoke-=1;c.callback()}}}a.startTimer()},triggerUserHasLeftPage:function triggerUserHasLeftPage(){if(a.active){for(var b=0;b<this.userLeftCallbacks.length;b++){var c=this.userLeftCallbacks[b],d=c.numberOfTimesToInvoke;if(isNaN(d)||d===void 0||0<d){c.numberOfTimesToInvoke-=1;c.callback()}}}a.stopAllTimers()},callAfterTimeElapsedInSeconds:function callAfterTimeElapsedInSeconds(b,c){a.timeElapsedCallbacks.push({timeInSeconds:b,callback:c,pending:!0})},checkState:function checkState(){for(var b=0;b<a.timeElapsedCallbacks.length;b++){if(a.timeElapsedCallbacks[b].pending&&a.getTimeOnCurrentPageInSeconds()>a.timeElapsedCallbacks[b].timeInSeconds){a.timeElapsedCallbacks[b].callback();a.timeElapsedCallbacks[b].pending=!1}}if(!1===a.idle&&a.currentIdleTimeMs>a.idleTimeoutMs){a.idle=!0;a.triggerUserHasLeftPage()}else{a.currentIdleTimeMs+=a.checkStateRateMs}},visibilityChangeEventName:void 0,hiddenPropName:void 0,listenForVisibilityEvents:function listenForVisibilityEvents(){if("undefined"!=typeof document.hidden){a.hiddenPropName="hidden";a.visibilityChangeEventName="visibilitychange"}else if("undefined"!=typeof document.mozHidden){a.hiddenPropName="mozHidden";a.visibilityChangeEventName="mozvisibilitychange"}else if("undefined"!=typeof document.msHidden){a.hiddenPropName="msHidden";a.visibilityChangeEventName="msvisibilitychange"}else if("undefined"!=typeof document.webkitHidden){a.hiddenPropName="webkitHidden";a.visibilityChangeEventName="webkitvisibilitychange"}document.addEventListener(a.visibilityChangeEventName,function(){if(document[a.hiddenPropName]){a.triggerUserHasLeftPage()}else{a.triggerUserHasReturned()}},!1);window.addEventListener("blur",function(){a.triggerUserHasLeftPage()});window.addEventListener("focus",function(){a.triggerUserHasReturned()});document.addEventListener("mousemove",function(){a.resetIdleCountdown()});document.addEventListener("keyup",function(){a.resetIdleCountdown()});document.addEventListener("touchstart",function(){a.resetIdleCountdown()});window.addEventListener("scroll",function(){a.resetIdleCountdown()});setInterval(function(){a.checkState()},a.checkStateRateMs)},websocket:void 0,websocketHost:void 0,setUpWebsocket:function setUpWebsocket(b){if(window.WebSocket&&b){var c=b.websocketHost;try{a.websocket=new WebSocket(c);window.onbeforeunload=function(){a.sendCurrentTime(b.appId)};a.websocket.onopen=function(){a.sendInitWsRequest(b.appId)};a.websocket.onerror=function(a){if(console){console.log("Error occurred in websocket connection: "+a)}};a.websocket.onmessage=function(a){if(console){console.log(a.data)}}}catch(a){if(console){console.error("Failed to connect to websocket host.  Error:"+a)}}}return this},websocketSend:function websocketSend(b){a.websocket.send(JSON.stringify(b))},sendCurrentTime:function sendCurrentTime(b){var c=a.getTimeOnCurrentPageInMilliseconds(),d={type:"INSERT_TIME",appId:b,timeOnPageMs:c,pageName:a.currentPageName};a.websocketSend(d)},sendInitWsRequest:function sendInitWsRequest(b){a.websocketSend({type:"INIT",appId:b})},initialize:function initialize(b){var c=a.idleTimeoutMs||30,d=a.currentPageName||"default-page-name",e=void 0,f=void 0;if(b){c=b.idleTimeoutInSeconds||c;d=b.currentPageName||d;e=b.websocketOptions;f=b.initialStartTime}a.setIdleDurationInSeconds(c).setCurrentPageName(d).setUpWebsocket(e).listenForVisibilityEvents();a.startTimer(void 0,f)}};return a})}).call(this);
//# sourceMappingURL=timeme.min.js.map
